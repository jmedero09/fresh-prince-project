<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RoastMaster | Coffee Roasting Planner</title>
  <link rel="stylesheet" type="text/css" href="mystyle.css">
</head>
<body>
  <header class="hero">
    <div class="hero__content">
      <p class="eyebrow">Coffee Lab</p>
      <h1>RoastMaster</h1>
      <p class="lede">Plan, track, and log every roast with a calm workspace designed for focused roasting sessions.</p>
      <div class="hero__actions">
        <button id="start-roast" class="btn btn--primary">Start Roast</button>
        <button id="stop-roast" class="btn btn--ghost">Stop Roast</button>
        <button id="reset-session" class="btn btn--ghost">Reset Session</button>
      </div>
    </div>
    <div class="hero__illustration">
      <div class="drum">
        <div class="bean"></div>
        <div class="bean bean--2"></div>
        <div class="bean bean--3"></div>
      </div>
      <p class="status" id="session-status">Idle • waiting to charge</p>
    </div>
  </header>

  <main class="grid">
    <section class="panel" aria-labelledby="inventory-title">
      <div class="panel__header">
        <div>
          <p class="eyebrow">Inventory</p>
          <h2 id="inventory-title">Bean library</h2>
        </div>
        <button class="btn btn--small" id="add-bean">Add bean</button>
      </div>
      <div class="table">
        <div class="table__head">
          <span>Bean</span>
          <span>Origin</span>
          <span>Weight (g)</span>
        </div>
        <div id="bean-rows"></div>
      </div>
    </section>

    <section class="panel" aria-labelledby="roast-planner-title">
      <div class="panel__header">
        <div>
          <p class="eyebrow">Planner</p>
          <h2 id="roast-planner-title">Roast profile</h2>
        </div>
      </div>
      <form id="roast-form" class="form">
        <label>
          Bean selection
          <select id="bean-select"></select>
        </label>
        <label>
          Charge temperature (°C)
          <input type="number" id="charge-temp" min="160" max="230" value="200" required>
        </label>
        <label>
          First crack target (minutes)
          <input type="number" id="first-crack" min="5" max="12" step="0.1" value="8.5" required>
        </label>
        <label>
          Development time (minutes)
          <input type="number" id="development" min="1" max="5" step="0.1" value="2.0" required>
        </label>
        <label>
          Notes
          <textarea id="notes" rows="3" placeholder="Flavor goals, venting notes, charge adjustments..."></textarea>
        </label>
        <button type="submit" class="btn btn--primary">Save profile</button>
      </form>
    </section>

    <section class="panel" aria-labelledby="roast-log-title">
      <div class="panel__header">
        <div>
          <p class="eyebrow">Session</p>
          <h2 id="roast-log-title">Roast log</h2>
        </div>
      </div>
      <div class="log" id="roast-log"></div>
    </section>

    <section class="panel" aria-labelledby="live-roast-title">
      <div class="panel__header">
        <div>
          <p class="eyebrow">Live</p>
          <h2 id="live-roast-title">Live roast tracker</h2>
        </div>
      </div>
      <div class="tracker">
        <div class="progress">
          <div id="progress-bar" class="progress__bar" style="width: 0%"></div>
        </div>
        <div class="controls-grid">
          <div class="control-group">
            <p class="eyebrow">Stage markers</p>
            <div class="chip-row">
              <button id="mark-yellow" type="button" class="btn btn--chip">Yellowing</button>
              <button id="mark-first-crack" type="button" class="btn btn--chip">First crack</button>
              <button id="mark-second-crack" type="button" class="btn btn--chip">Second crack</button>
            </div>
          </div>
          <div class="control-group">
            <p class="eyebrow">Roast weight</p>
            <div class="weight-grid">
              <label>
                Green weight (g)
                <input type="number" id="green-weight" min="0" step="0.1" placeholder="Enter before roasting">
              </label>
              <label>
                Roasted weight (g)
                <input type="number" id="roasted-weight" min="0" step="0.1" placeholder="Enter after roasting">
              </label>
            </div>
            <p id="weight-summary" class="weight-summary">Awaiting weights…</p>
          </div>
        </div>
        <div class="metrics">
          <div>
            <p class="eyebrow">Stage</p>
            <p id="stage-text" class="metric">Idle</p>
          </div>
          <div>
            <p class="eyebrow">Elapsed</p>
            <p id="elapsed" class="metric">0:00</p>
          </div>
          <div>
            <p class="eyebrow">Charge</p>
            <p id="charge-display" class="metric">200°C</p>
          </div>
        </div>
        <div class="event-grid" id="event-grid"></div>
      </div>
    </section>
  </main>

  <template id="bean-row-template">
    <div class="table__row">
      <span class="bean-name"></span>
      <span class="bean-origin"></span>
      <span class="bean-weight"></span>
    </div>
  </template>

  <template id="log-entry-template">
    <article class="log__entry">
      <header>
        <p class="eyebrow log__bean"></p>
        <p class="log__title"></p>
      </header>
      <p class="log__meta"></p>
      <p class="log__notes"></p>
    </article>
  </template>

  <script>
    const beanRows = document.getElementById('bean-rows');
    const beanSelect = document.getElementById('bean-select');
    const beanRowTemplate = document.getElementById('bean-row-template');
    const logTemplate = document.getElementById('log-entry-template');
    const roastLog = document.getElementById('roast-log');
    const eventGrid = document.getElementById('event-grid');

    const statusText = document.getElementById('session-status');
    const stageText = document.getElementById('stage-text');
    const elapsedEl = document.getElementById('elapsed');
    const chargeDisplay = document.getElementById('charge-display');
    const progressBar = document.getElementById('progress-bar');

    const startRoastBtn = document.getElementById('start-roast');
    const stopRoastBtn = document.getElementById('stop-roast');
    const resetSessionBtn = document.getElementById('reset-session');
    const roastForm = document.getElementById('roast-form');
    const markYellowBtn = document.getElementById('mark-yellow');
    const markFirstCrackBtn = document.getElementById('mark-first-crack');
    const markSecondCrackBtn = document.getElementById('mark-second-crack');

    const greenWeightInput = document.getElementById('green-weight');
    const roastedWeightInput = document.getElementById('roasted-weight');
    const weightSummary = document.getElementById('weight-summary');

    let beans = [
      { name: 'Ethiopia Yirgacheffe', origin: 'Ethiopia', weight: 1200 },
      { name: 'Guatemala Huehuetenango', origin: 'Guatemala', weight: 900 },
      { name: 'Colombia Huila', origin: 'Colombia', weight: 750 }
    ];

    let activeTimer = null;
    let elapsedSeconds = 0;
    let plannedDuration = 0;
    let activeProfile = null;

    function renderBeans() {
      beanRows.innerHTML = '';
      beanSelect.innerHTML = '';
      beans.forEach((bean, index) => {
        const row = beanRowTemplate.content.cloneNode(true);
        row.querySelector('.bean-name').textContent = bean.name;
        row.querySelector('.bean-origin').textContent = bean.origin;
        row.querySelector('.bean-weight').textContent = `${bean.weight}g`;
        beanRows.appendChild(row);

        const option = document.createElement('option');
        option.value = index;
        option.textContent = bean.name;
        beanSelect.appendChild(option);
      });
    }

    function logRoast({ bean, chargeTemp, firstCrack, development, notes }) {
      const entry = logTemplate.content.cloneNode(true);
      entry.querySelector('.log__bean').textContent = bean.name;
      entry.querySelector('.log__title').textContent = `Charge ${chargeTemp}°C → FC ${firstCrack}m → Dev ${development}m`;
      const totalTime = (Number(firstCrack) + Number(development)).toFixed(1);
      entry.querySelector('.log__meta').textContent = `Total time ${totalTime} minutes • ${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
      entry.querySelector('.log__notes').textContent = notes || 'No additional notes.';
      roastLog.prepend(entry);
    }

    function addEvent(label, time) {
      const event = document.createElement('div');
      event.className = 'event';
      event.innerHTML = `<span>${label}</span><strong>${time}</strong>`;
      eventGrid.prepend(event);
    }

    function updateWeightSummary() {
      const green = Number(greenWeightInput.value);
      const roasted = Number(roastedWeightInput.value);

      if (Number.isNaN(green) || Number.isNaN(roasted) || green <= 0 || roasted <= 0) {
        weightSummary.textContent = 'Awaiting weights…';
        weightSummary.classList.remove('weight-summary--alert');
        return;
      }

      const lossPct = ((green - roasted) / green) * 100;
      const rounded = lossPct.toFixed(1);
      let classification = 'Light';
      if (lossPct >= 17) {
        classification = 'Dark';
      } else if (lossPct >= 14) {
        classification = 'Medium';
      }

      weightSummary.textContent = `Weight loss ${rounded}% • ${classification} roast`;
      weightSummary.classList.add('weight-summary--alert');
    }

    function formatTime(totalSeconds) {
      const minutes = Math.floor(totalSeconds / 60).toString();
      const seconds = (totalSeconds % 60).toString().padStart(2, '0');
      return `${minutes}:${seconds}`;
    }

    function stopTimer() {
      if (activeTimer) {
        clearInterval(activeTimer);
        activeTimer = null;
      }
    }

    function resetSession() {
      stopTimer();
      elapsedSeconds = 0;
      plannedDuration = 0;
      activeProfile = null;
      progressBar.style.width = '0%';
      stageText.textContent = 'Idle';
      elapsedEl.textContent = '0:00';
      statusText.textContent = 'Idle • waiting to charge';
      eventGrid.innerHTML = '';
      weightSummary.textContent = 'Awaiting weights…';
      weightSummary.classList.remove('weight-summary--alert');
      greenWeightInput.value = '';
      roastedWeightInput.value = '';
    }

    function runRoast(profile) {
      stopTimer();
      elapsedSeconds = 0;
      plannedDuration = Math.round((Number(profile.firstCrack) + Number(profile.development)) * 60);
      activeProfile = profile;
      chargeDisplay.textContent = `${profile.chargeTemp}°C`;
      statusText.textContent = `${profile.bean.name} • Charging`;
      stageText.textContent = 'Charging';
      addEvent('Charge', '0:00');

      activeTimer = setInterval(() => {
        elapsedSeconds += 1;
        const pct = Math.min((elapsedSeconds / plannedDuration) * 100, 100);
        progressBar.style.width = `${pct}%`;
        elapsedEl.textContent = formatTime(elapsedSeconds);

        const elapsedMinutes = elapsedSeconds / 60;
        if (elapsedMinutes >= profile.firstCrack && stageText.textContent !== 'First crack') {
          stageText.textContent = 'First crack';
          statusText.textContent = `${profile.bean.name} • First crack underway`;
          addEvent('First crack', formatTime(elapsedSeconds));
        }

        if (elapsedMinutes >= profile.firstCrack + profile.development) {
          stageText.textContent = 'Drop';
          statusText.textContent = `${profile.bean.name} • Drop now`;
          addEvent('Drop', formatTime(elapsedSeconds));
          stopTimer();
        }
      }, 1000);
    }

    function pauseRoast() {
      if (!activeProfile) return;
      stopTimer();
      stageText.textContent = 'Paused';
      statusText.textContent = `${activeProfile.bean.name} • Paused at ${formatTime(elapsedSeconds)}`;
      addEvent('Paused', formatTime(elapsedSeconds));
    }

    function markStage(label, stageName) {
      if (!activeProfile) return;
      stageText.textContent = stageName;
      statusText.textContent = `${activeProfile.bean.name} • ${stageName}`;
      addEvent(label, formatTime(elapsedSeconds));
    }

    document.getElementById('add-bean').addEventListener('click', () => {
      const name = prompt('Bean name');
      const origin = prompt('Origin');
      const weight = Number(prompt('Weight in grams', '500'));
      if (!name || !origin || Number.isNaN(weight)) return;
      beans = [...beans, { name, origin, weight }];
      renderBeans();
    });

    roastForm.addEventListener('submit', (event) => {
      event.preventDefault();
      const bean = beans[Number(beanSelect.value)];
      const chargeTemp = Number(document.getElementById('charge-temp').value);
      const firstCrack = Number(document.getElementById('first-crack').value);
      const development = Number(document.getElementById('development').value);
      const notes = document.getElementById('notes').value.trim();

      logRoast({ bean, chargeTemp, firstCrack, development, notes });
      runRoast({ bean, chargeTemp, firstCrack, development });
    });

    startRoastBtn.addEventListener('click', () => {
      const bean = beans[Number(beanSelect.value)] || beans[0];
      const chargeTemp = Number(document.getElementById('charge-temp').value);
      const firstCrack = Number(document.getElementById('first-crack').value);
      const development = Number(document.getElementById('development').value);
      runRoast({ bean, chargeTemp, firstCrack, development });
    });

    stopRoastBtn.addEventListener('click', pauseRoast);
    resetSessionBtn.addEventListener('click', resetSession);

    markYellowBtn.addEventListener('click', () => markStage('Yellow', 'Yellowing'));
    markFirstCrackBtn.addEventListener('click', () => markStage('First crack', 'First crack'));
    markSecondCrackBtn.addEventListener('click', () => markStage('Second crack', 'Second crack'));

    greenWeightInput.addEventListener('input', updateWeightSummary);
    roastedWeightInput.addEventListener('input', updateWeightSummary);

    renderBeans();
    resetSession();
  </script>
</body>
</html>
